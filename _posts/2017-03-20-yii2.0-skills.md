---
layout: post
category: ['Yii2.0']
title: Yii2.0 小技巧
---
# 查看版本:
`cd到项目目录 终端输入 ./yii`

# 输出sql语句:
```php
$query = Order::find()->where(['order_id'=>[1,2]])->select(['id']);
$commandQuery = clone $query;
echo $commandQuery->createCommand()->getRawSql();
exit;
```
# 监测性能:
```php
\YII::beginProfile('profile1');
echo "hello world~";
sleep(1);
\YII::endProfile('profile1');
```
`然后到Debug中的Profiling查看`

# Yii2的Alert组件（弹窗提示信息)
该组件提供

**五种类型提示:**

`error，danger，success，info，warning`

**总的样式有四种:**

`alert-danger，lert-success，alert-info，alert-warning`


```php
// 单条消息：
\Yii::$app->getSession()->setFlash('error', 'This is the message');

\Yii::$app->getSession()->setFlash('danger', 'This is the message');

\Yii::$app->getSession()->setFlash('success', 'This is the message');

\Yii::$app->getSession()->setFlash('info', 'This is the message');

\Yii::$app->getSession()->setFlash('warning', 'This is the message');

// 多条消息：
\Yii::$app->getSession()->setFlash('error', ['Error 1', 'Error 2']);

```
## eg:
### 控制层:
```php
public function actionDelete($id)
{
    $model = new Attributelist();
    $child = $model->find()->where(['pid'=>$id])->asArray()->all();

    // ---------------若有子类 则不能删除-----------------------
    if (empty($child)){
        $this->findModel($id)->delete();
    }
    else{
        \Yii::$app->getSession()->setFlash('error', '该删除项有子类,不能删除!');
    }
    return $this->redirect(['index']);
}
```
### 视图层:

`先引入 Alert：use yii\bootstrap\Alert;`

```html
<div>
	<?php
	    if( Yii::$app->getSession()->hasFlash('error') ) {
	    echo Alert::widget([
	        'options' => [
	            'class' => 'alert-danger',
	        ],
	        'body' => Yii::$app->getSession()->getFlash('error'),
	    ]);
	}
	?>
</div>

```
`若出现两个提示框,去掉widget后面的参数`

# 中国话/Yii::t()使用方法

1.在gii中 创建 Model Generator 的时候,记得 打勾 `Enable I18N`(省得后面自己写)

2.因为是 前后台共用 的翻译语言,so 在common目录下创建messages/zh_CN/app.php文件

完整目录是 `common/messages/zh_CN/app.php`

`app.php`文件内容:
```php
/**
 * app.php
 * 翻译文件
 */
return [
    'ID' => 'id',
    'Name' => '名字',
    'Create' => '创建',
    'Delete' => '删除',
    // ...
];
```
修改`common/config/main.php`

在`components`中添加以下
```php
'language' => 'zh-CN',
'i18n' => [
    'translations' => [
        'app*' => [
            'class' => 'yii\i18n\PhpMessageSource',
            'basePath' => '@common/messages/',
            // 'sourceLanguage' => 'en',
            'fileMap' => [
                'app' => 'app.php',
                'app/error' => 'error.php',
            ],
        ],
        'model*' => [
            'class' => 'yii\i18n\PhpMessageSource',
            'basePath' => '@common/messages',
            'fileMap' => [
                'model' => 'model.php'
            ]
        ]
    ],
],
```
### 使用:
```php
public function attributeLabels()
{
    return [
        'id' => 'ID',
        'name' => Yii::t('app','Name'),
        'mobile' => Yii::t('app','Mobile'),
        // ...
    ];
}
```

参考更多:
-<http://www.yiifans.com/yii2/guide/tutorial-i18n.html>

# 系统定义的路径
```php
'@yii' =>
      '@yii/swiftmailer' => string 'C:\wamp\www\advanced\vendor/yiisoft/yii2-swiftmailer' (length=52)
      '@yii/gii' => string 'C:\wamp\www\advanced\vendor/yiisoft/yii2-gii' (length=44)
      '@yii/faker' => string 'C:\wamp\www\advanced\vendor/yiisoft/yii2-faker' (length=46)
      '@yii/debug' => string 'C:\wamp\www\advanced\vendor/yiisoft/yii2-debug' (length=46)
      '@yii/codeception' => string 'C:\wamp\www\advanced\vendor/yiisoft/yii2-codeception' (length=52)
      '@yii/bootstrap' => string 'C:\wamp\www\advanced\vendor/yiisoft/yii2-bootstrap' (length=50)
      '@yii' => string 'C:\wamp\www\advanced\vendor\yiisoft\yii2' (length=40)
  '@app' => string 'C:\wamp\www\advanced\frontend' (length=29)
  '@vendor' => string 'C:\wamp\www\advanced/vendor' (length=27)
  '@bower' => string 'C:\wamp\www\advanced/vendor\bower' (length=33)
  '@npm' => string 'C:\wamp\www\advanced/vendor\npm' (length=31)
  '@runtime' => string 'C:\wamp\www\advanced\frontend\runtime' (length=37)
  '@webroot' => string 'C:/wamp/www/advanced/frontend/web' (length=33)
  '@web' => string '/advanced/frontend/web' (length=22)
```
`其中最常用的别名有`
@app

@vendor

@runtime

@webroot

@web

而且可以看到除了`@web`别名是`url`外，其它的都是物理路径

# 过滤器
```php
public function behaviors()
{
    return [
        'access' => [
            'class' => \yii\filters\AccessControl::className(),// 访问行为
            'only'  => ['*'],// 对所在的控制器的哪些方法做验证
            // 'except'=> [], // 除了哪一个方法
            'rules' => [
                [
                    'allow'  => false,
                    'actions'=> [],// 方法名 针对哪些方法不允许访问
                    'roles'  => ['?'],// ?代表 未登陆的 用户
                ],
                [
                    'allow'  => true,
                    'actions'=> [],// 方法名 针对哪些方法允许访问
                    'roles'  => ['@'],// @代表 登陆的 用户
                ],
            ],
        ],
    ];
}
```
# **未完,待续~~**
