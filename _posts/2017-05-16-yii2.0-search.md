---
layout: post
category: ['Yii2.0']
title: Yii2.0 关联搜索
---

*效果:*

![效果](http://oi2atwmcz.bkt.clouddn.com/WX20170516-163806.png)

假设 *bolg* 表中的 `user_id` 和 *user* 表中的 `id` *关联*
***

# 首先,建立两表的关联关系

在 `模型blog` 中,修改 `attributeLabels()` 方法, 并 *增加*`getUser()` 方法,
```php
use common\models\User; // 记得引用
//...
public function attributeLabels()
{
	// 文字修改成中文
    return [
        'id' => 'ID',
        'title' => '标题',
        'content' => '内容',
        'create_time' => '创建时间',
        'status' => '状态',
        'username' => '作者', // 增加这个字段
    ];
}

// ...

public function getUser()
{
    return $this->hasOne(User::className(), ['id'=>'user_id']);
}
```

# 视图 `index.php` 中
```html
    <?= GridView::widget([
        'dataProvider' => $dataProvider,
        'filterModel' => $searchModel,
        'columns' => [
            // ['class' => 'yii\grid\SerialColumn'],

            'id',
            'title',
            'user.username',
            'content:ntext',
            [
                'format' => 'html', // 表示此列内容为html格式，输出时不会被转义
                'filter' => [ // 过滤器，也就是搜索框。该值为数组时会显示一个下拉框（dropdown list）
                    BlogForm::STATUS_HIDE => '隐藏',
                    BlogForm::STATUS_SHOW => '显示',
                ],
                'attribute' => 'status', // 字段名
                'value' => function ($model){ // 该列内容
                    if($model->status == BlogForm::STATUS_HIDE) return '<span class="label label-danger">隐藏中</span>';
                    if($model->status == BlogForm::STATUS_SHOW) return '<span class="label label-success">显示中</span>';
                },
            ],
            'create_time:datetime',

            ['class' => 'backend\column\BlogColumn'],
        ],
    ]); ?>
```
![](http://oi2atwmcz.bkt.clouddn.com/3.png)
